/*! For license information please see editor.bundle.js.LICENSE.txt */
(()=>{"use strict";var t,e=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a={method:t},i={};o&&(i.Authorization="Bearer "+localStorage.getItem("access_token")),n?(a.body=JSON.stringify(n),i["Content-Type"]="application/json"):r&&(a.body=r),a.headers=new Headers(i);var c=fetch(e,a);return c},n=(t=API_URL,{getProjects:function(n,r,o,a){var i="".concat(t,"/projects/?skip=").concat(n,"&limit=").concat(r,"&orderby=").concat(o,"&orderdir=").concat(a);return e("GET",i,null,null,!0)},getProject:function(n){var r="".concat(t,"/project/").concat(n);return e("GET",r,null,null,!0)},deleteProject:function(n){var r="".concat(t,"/project/").concat(n);return e("DELETE",r,null,null,!0)},createProject:function(n){var r="".concat(t,"/projects/");return e("POST",r,n,null,!0)},updateProject:function(n,r){var o="".concat(t,"/project/").concat(n);return e("PUT",o,r,null,!0)},getAnnotationIds:function(){var n="".concat(t,"/annotation_ids/");return e("GET",n,null,null,!0)},exportProject:function(n){var r="".concat(t,"/export/").concat(n);return e("GET",r,null,null,!0)},importProject:function(n){var r="".concat(t,"/import/");return e("POST",r,null,n,!0)},getImages:function(n){var r="".concat(t,"/project/").concat(n,"/images/");return e("GET",r,null,null,!0)},getImageFile:function(n){var r="".concat(t,"/image_file/").concat(n);return e("GET",r,null,null,!0)},createImages:function(n,r){var o="".concat(t,"/project/").concat(n,"/images/");return e("POST",o,null,r,!0)},deleteImage:function(n){var r="".concat(t,"/image/").concat(n);return e("DELETE",r,null,null,!0)},getAnnotation:function(n){var r="".concat(t,"/annotation/").concat(n);return e("GET",r,null,null,!0)},updateAnnotation:function(n,r){var o="".concat(t,"/annotation/").concat(n);return e("PUT",o,r,null,!0)},createUser:function(n){var r="".concat(t,"/users/");return e("POST",r,n,null,!1)},loginUser:function(n){var r="".concat(t,"/token");return e("POST",r,null,n,!1)},isValid:function(n){var r="".concat(t,"/isvalid/").concat(n);return e("GET",r,null,null,!1)}});function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(){o=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof p?e:p,a=Object.create(o.prototype),i=new E(r||[]);return a._invoke=function(t,e,n){var r="suspendedStart";return function(o,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw a;return{value:void 0,done:!0}}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var c=k(i,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=f(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(t,n,i),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var d={};function p(){}function h(){}function y(){}var v={};s(v,i,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(j([])));m&&m!==e&&n.call(m,i)&&(v=m);var x=y.prototype=p.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function o(a,i,c,l){var s=f(t[a],t,i);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==r(d)&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){o("next",t,c,l)}),(function(t){o("throw",t,c,l)})):e.resolve(d).then((function(t){u.value=t,c(u)}),(function(t){return o("throw",t,c,l)}))}l(s.arg)}var a;this._invoke=function(t,n){function r(){return new e((function(e,r){o(t,n,e,r)}))}return a=a?a.then(r,r):r()}}function k(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=f(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function j(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return h.prototype=y,s(x,"constructor",y),s(y,"constructor",h),h.displayName=s(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,s(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},w(b.prototype),s(b.prototype,c,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var i=new b(u(e,n,r,o),a);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},w(x),s(x,l,"Generator"),s(x,i,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=j,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;_(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:j(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function a(t,e,n,r,o,a,i){try{var c=t[a](i),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,o)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(t){a(i,r,o,c,l,"next",t)}function l(t){a(i,r,o,c,l,"throw",t)}c(void 0)}))}}function c(){return l.apply(this,arguments)}function l(){return(l=i(o().mark((function t(){var e,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getAnnotationIds();case 2:if(200!=(e=t.sent).status){t.next=10;break}return t.next=6,e.json();case 6:return r=t.sent,t.abrupt("return",r);case 10:if(401!=e.status){t.next=14;break}m(),t.next=15;break;case 14:throw new Error("Failed to get annotation ids");case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function s(t){return u.apply(this,arguments)}function u(){return(u=i(o().mark((function t(e){var r,a,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getImageFile(e);case 2:if(200!=(r=t.sent).status){t.next=11;break}return t.next=6,r.blob();case 6:return a=t.sent,i=URL.createObjectURL(a),t.abrupt("return",i);case 11:if(401!=r.status){t.next=15;break}m(),t.next=16;break;case 15:throw new Error("Failed to get image file with id ".concat(e));case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function f(){return d.apply(this,arguments)}function d(){return(d=i(o().mark((function t(){var e,r,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=localStorage.getItem("access_token")){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,n.isValid(e);case 5:if(200!=(r=t.sent).status){t.next=13;break}return t.next=9,r.json();case 9:return a=t.sent,t.abrupt("return",a.isvalid);case 13:throw new Error("Failed to determine whether user is logged in");case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){return h.apply(this,arguments)}function h(){return(h=i(o().mark((function t(e){var r,a,i,c,l;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.exportProject(e);case 2:if(200!=(r=t.sent).status){t.next=18;break}return a=r.headers.get("Content-Disposition"),i=(i=a.split(/;(.+)/)[1].split(/=(.+)/)[1]).toLowerCase().startsWith("utf-8''")?decodeURIComponent(i.replace("utf-8''","")):i.replace(/['"]/g,""),t.next=9,r.blob();case 9:c=t.sent,(l=document.createElement("a")).href=URL.createObjectURL(c),l.download=i,document.body.appendChild(l),l.click(),l.remove(),t.next=23;break;case 18:if(401!=r.status){t.next=22;break}m(),t.next=23;break;case 22:throw new Error("Failed to export project with id ".concat(e));case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function y(t){return v.apply(this,arguments)}function v(){return(v=i(o().mark((function t(e){var n,r,a,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=FRONTEND_URLS.getEditProjectUrl+"?project_id="+e,r={method:"GET",headers:new Headers({Authorization:"Bearer "+localStorage.getItem("access_token")})},t.next=4,fetch(n,r);case 4:if(200!=(a=t.sent).status){t.next=12;break}return t.next=8,a.json();case 8:i=t.sent,window.location.href=i.url,t.next=17;break;case 12:if(401!=a.status){t.next=16;break}m(),t.next=17;break;case 16:throw new Error("Failed to get url for setting up project with id ".concat(e));case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(){return(g=i(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f();case 2:t.sent?e():m();case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(){window.location.href=FRONTEND_URLS.login}function x(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))}function w(t){var e=document.createElement("template");return e.innerHTML=t,e.content}function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function k(){k=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof f?e:f,a=Object.create(o.prototype),i=new E(r||[]);return a._invoke=function(t,e,n){var r="suspendedStart";return function(o,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw a;return{value:void 0,done:!0}}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var c=w(i,n);if(c){if(c===u)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=s(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(t,n,i),a}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function f(){}function d(){}function p(){}var h={};c(h,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(j([])));v&&v!==e&&n.call(v,o)&&(h=v);var g=p.prototype=f.prototype=Object.create(h);function m(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(o,a,i,c){var l=s(t[o],t,a);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==b(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(f).then((function(t){u.value=t,i(u)}),(function(t){return r("throw",t,i,c)}))}c(l.arg)}var o;this._invoke=function(t,n){function a(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,u;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function j(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=p,c(g,"constructor",p),c(p,"constructor",d),d.displayName=c(p,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,i,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(x.prototype),c(x.prototype,a,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var i=new x(l(e,n,r,o),a);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},m(g),c(g,i,"Generator"),c(g,o,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=j,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;_(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:j(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}function L(t){return function(t){if(Array.isArray(t))return j(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||E(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(t,e)||E(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(t,e){if(t){if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(t,e):void 0}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function S(t,e,n,r,o,a,i){try{var c=t[a](i),l=c.value}catch(t){return void n(t)}c.done?e(l):Promise.resolve(l).then(r,o)}function P(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){S(a,r,o,i,c,"next",t)}function c(t){S(a,r,o,i,c,"throw",t)}i(void 0)}))}}var O="Annotation saved.",I="Failed to save annotation.",T=new mdc.list.MDCList(document.getElementById("images-selection-list"));T.singleSelection=!0;var A=new mdc.snackbar.MDCSnackbar(document.querySelector(".mdc-snackbar"));function N(){return N=P(k().mark((function t(e){var r,o,a,i,l,u,f,d,h,v,g,b,E,j,S,N,G,F,D,U,C,B,R,M,z,V,Y,q,H,J,W,$,K,Q,X,Z,tt,et,nt,rt,ot,at,it,ct,lt,st,ut,ft,dt,pt,ht;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ht=function(){return(ht=P(k().mark((function t(e){var n;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={data:{image:r.name,grid_cells:F,corners:G,auxlines:v,auxcurves:g,prev_intersections:h}},t.next=3,R(e,n);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)},pt=function(t){return ht.apply(this,arguments)},st=function(t){for(var e=d3.select(this.parentNode).attr("id"),n=0;n<g.length;n++)g[n].id==e&&(this.classList.contains("auxcurve-startpoint")?(g[n].points[0][0]=d3.event.x,g[n].points[0][1]=d3.event.y):this.classList.contains("auxcurve-middlepoint")?(g[n].points[1][0]=d3.event.x,g[n].points[1][1]=d3.event.y):this.classList.contains("auxcurve-endpoint")&&(g[n].points[2][0]=d3.event.x,g[n].points[2][1]=d3.event.y),d3.select(this.parentNode).select("path").attr("d",lt(g[n].points)));d3.select(this).attr("cx",d3.event.x).attr("cy",d3.event.y),W(),dt()},lt=function(t){return d3.line().curve(d3.curveCatmullRom.alpha(1))(t)},ct=function(t){this.classList.contains("auxline-startpoint")?d3.select(this.parentNode).select("line").attr("x1",t.x1=d3.event.x).attr("y1",t.y1=d3.event.y):this.classList.contains("auxline-endpoint")&&d3.select(this.parentNode).select("line").attr("x2",t.x2=d3.event.x).attr("y2",t.y2=d3.event.y),d3.select(this).attr("cx",t.cx=d3.event.x).attr("cy",t.cy=d3.event.y),W(),dt()},it=function(t){d3.select(this).attr("cx",t.x=d3.event.x).attr("cy",t.y=d3.event.y);for(var e=0;e<F.length;e++)for(var n=0;n<F[e].corners.length;n++)F[e].corners[n].id==t.id&&(F[e].corners[n]=t,F[e].center=et(F[e].corners));W(),dt()},at=function(t){K.select("#g_element").attr("cursor","default")},ot=function(t){d3.select(this).raise(),K.select("#g_element").attr("cursor","grabbing")},rt=function(t){if(console.log("corner_mouseclick_handler"),"center_manual"==u)if(G.length<4)alert("Before you can create a grid cell you need to place at least four corner markers first.");else if(S.push(t),4==S.length){S=tt(S);var e=et(S);F.push({corners:S,center:e,id:x(),truncated:!1}),console.log("Placed a new grid cell at (",e.x,",",e.y,")"),S=[],W(),dt()}},nt=function(){function t(t,e){var n,r=[],o=Intersection.intersectShapes(t,e);for(i in o.points)"Vector2D"!=o.points[i].constructor.name&&"Point2D"!=o.points[i].constructor.name||r.push({x:o.points[i].x,y:o.points[i].y});return void 0!==r?(n=r).filter((function(t,e){return n.indexOf(t)===e})):[]}for(var e=[],n=0;n<v.length+g.length;n++)for(var r=n+1;r<v.length+g.length;r++){for(var o=[K.selectAll(".auxobj").nodes()[n],K.selectAll(".auxobj").nodes()[r]],a=[],i=0;i<2;i++)o[i].classList.contains("auxline")?a.push(new Line(o[i])):o[i].classList.contains("auxcurve")&&a.push(new Path(o[i]));var c=t(a[0],a[1]);e.push.apply(e,L(c))}var l=function(t,e){for(var n=[],r=[],o=[],a=0;a<e.length;a++)t.some((function(t){return t.x==e[a].x&&t.y==e[a].y}))?o.push(e[a]):n.push(e[a]);for(a=0;a<t.length;a++)e.some((function(e){return e.x==t[a].x&&e.y==t[a].y}))||r.push(t[a]);return[n,r,o]}(h,e),s=_(l,3),u=s[0],f=s[1];for(s[2],h=[].concat(e),i=0;i<u.length;i++)G.push({x:u[i].x,y:u[i].y,id:x()});for(n=G.length-1;n>=0;n--)if(f.some((function(t){return t.x==G[n].x&&t.y==G[n].y}))){var d=[];for(i=0;i<F.length;i++)for(var p=0;p<F[i].corners.length;p++)F[i].corners[p].id==G[n].id&&d.push(i);for(i=d.length-1;i>=0;i--)console.log("Deleting grid cell "+F[i].id+"(it contained deleted point "+G[n].id+")"),F.splice(d[i],1);G.splice(n,1)}},Q=function(t){var e=t.transform.baseVal.consolidate().matrix;return[e.e,e.f,e.d]},$=function(t){q(),K.selectAll("*").remove(),H(),v=[],g=[],h=[],G=[],F=[],u="auxline",N="",J(X),document.getElementById("btn-draw-auxline").classList.add("btn-active");var e=K.append("g").attr("id","g_element"),n=K.select("#g_element").append("image"),o=T.selectedIndex,a=(r={id:t.target.children[o].dataset.imageId,name:t.target.children[o].dataset.imageName}).id;s(a).then((function(t){n.attr("href",t)}));var c=d3.zoom().on("zoom",(function(){e.attr("transform",d3.event.transform)}));c(K);var f=new Image;f.onload=function(){i=f.width,l=f.height,console.log("Changed image:",f.width,f.height);var t=Number(K.style("width").replace("px","")),e=Number(K.style("height").replace("px","")),n=t/2-i/2,r=e/2-l/2,o=d3.zoomIdentity.translate(n,r);K.call(c.transform,o)},s(a).then((function(t){f.src=t}));for(var d=0;d<4;d++)K.select("#g_element").append("line").attr("id","center-line-"+[d]).style("stroke","magenta").style("stroke-dasharray","2, 2").style("stroke-width",.5).style("stroke-opacity",0);K.select("#g_element").append("g").append("circle").attr("id","cursor").attr("r",2).style("fill","magenta").style("opacity",0).style("fill-opacity",1).style("stroke",null),K.select("#g_element").append("g").attr("id","g_auxobjects"),K.select("#g_element").append("g").attr("id","g_pv_modules"),K.select("#g_element").append("g").attr("id","g_corners"),null!==r.id&&C(r.id)},W=function(){o=!0},H=function(){b=[],E=[],S=[]},q=function(){o&&(null!=r.name&&(F.length>0||G.length>0||v.length>0||g.length>0)&&(pt(r.id),Y(r.id,!0)),o=!1)},Y=function(t,e){document.getElementById("images-selection-list-".concat(t)).querySelector(".menu-icon").style.visibility=e?"visible":"hidden"},V=function(t){var e='\n          <li id="images-selection-list-'.concat(t.id,'" data-image-id="').concat(t.id,'" data-image-name="').concat(t.name,'" class="mdc-deprecated-list-item" role="option">\n            <span class="mdc-deprecated-list-item__ripple"></span>\n            <span class="mdc-deprecated-list-item__text">').concat(z(t.name).slice(0,8),'</span>\n            <span class="mdc-deprecated-list-item__meta">\n              <i class="material-icons menu-icon" style="color:green; visibility: hidden;">check</i>\n            </span>\n          </li>');document.getElementById("images-selection-list").appendChild(w(e))},z=function(t){return t.split(".").slice(0,-1).join(".")},M=function(){return(M=P(k().mark((function t(e,r){var o;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.updateAnnotation(e,r);case 2:if(200!=(o=t.sent).status){t.next=9;break}console.log(O),A.labelText=O,A.open(),t.next=17;break;case 9:if(401!=o.status){t.next=13;break}m(),t.next=17;break;case 13:throw console.log(I),A.labelText=I,A.open(),new Error("Failed to save annotation");case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)},R=function(t,e){return M.apply(this,arguments)},B=function(){return(B=P(k().mark((function t(e){var r,o;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getAnnotation(e);case 2:if(200!=(r=t.sent).status){t.next=10;break}return t.next=6,r.json();case 6:"data"in(o=t.sent)&&["corners","grid_cells","auxlines","auxcurves","prev_intersections"].every((function(t){return Object.keys(o.data).includes(t)}))&&(G=o.data.corners,F=o.data.grid_cells,v=o.data.auxlines,g=o.data.auxcurves,h=o.data.prev_intersections,dt()),t.next=15;break;case 10:if(401!=r.status){t.next=14;break}m(),t.next=15;break;case 14:throw new Error("Failed to get annotation for image with id ".concat(e));case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)},C=function(t){return B.apply(this,arguments)},U=function(){return U=P(k().mark((function t(e){var r;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getImages(e);case 2:if(200!=(r=t.sent).status){t.next=10;break}return t.next=6,r.json();case 6:t.sent.foreach((function(t){V(t);var e=a.includes(t.id);Y(t.id,e)})),t.next=15;break;case 10:if(401!=r.status){t.next=14;break}m(),t.next=15;break;case 14:throw new Error("Failed to get images");case 15:case"end":return t.stop()}}),t)}))),U.apply(this,arguments)},D=function(t){return U.apply(this,arguments)},r={id:null,name:null},o=!1,a=[],u="auxline",h=[],v=[],g=[],b=[],E=[],S=[],N="",G=[],F=[],document.getElementById("export-project-button").addEventListener("click",p.bind(null,e)),document.getElementById("setup-project-button").addEventListener("click",y.bind(null,e)),t.next=41,c();case 41:a=t.sent,D(e),window.addEventListener("beforeunload",(function(t){t.preventDefault(),q(),console.log("Saved annotation before reload.")})),J=function(t){for(var e=t.querySelectorAll("button"),n=0;n<e.length;n++)e[n].classList.remove("btn-active")},document.getElementById("images-selection-list").addEventListener("MDCList:selectionChange",$),(K=d3.select("svg")).on("mousemove",(function(){var t=d3.mouse(this);if(!d3.select("#g_element").empty()){var e=_(Q(g_element),3),n=e[0],r=e[1],o=e[2];f=(t[0]-n)/o,d=(t[1]-r)/o,K.select("#cursor").attr("cx",f).attr("cy",d);for(var a=0;a<4;a++)K.select("#center-line-"+[a]).style("stroke-opacity",0);if(G.length>0&&"center"==u)for(j=function(t,e,n){for(var r=[],o=0;o<e.length;o++){var a=Math.pow(e[o].x-t.x,2)+Math.pow(e[o].y-t.y,2);r.push({dist:a,corner:e[o]})}return r.sort((function(t,e){return t.dist>e.dist?1:-1})).slice(0,4)}({x:f,y:d},G),a=0;a<j.length;a++)K.select("#center-line-"+[a]).attr("x1",f).attr("y1",d).attr("x2",j[a].corner.x).attr("y2",j[a].corner.y).style("stroke-opacity",1)}})),K.on("mouseover",(function(){if(K.select("#cursor").style("opacity",1),"center"==u)for(var t=0;t<4;t++)K.select("#center-line-"+[t]).style("stroke-opacity",1)})),K.on("mouseout",(function(){if(K.select("#cursor").style("opacity",0),"center"==u)for(var t=0;t<4;t++)K.select("#center-line-"+[t]).style("stroke-opacity",0)})),X=document.getElementById("drawing-actions"),Z=function(t){J(X),H(),N="",dt();var e=t.target;"btn-add-corner"==e.id?(u="corner",e.classList.add("btn-active"),K.select("#cursor").style("fill","magenta").style("fill-opacity",1).style("stroke",null),console.log("Switched to corner mode")):"btn-create-module"==e.id?(u="center",e.classList.add("btn-active"),K.select("#cursor").style("fill","black").style("fill-opacity",1).style("stroke",null),console.log("Switched to center mode")):"btn-create-module-manual"==e.id?(u="center_manual",e.classList.add("btn-active"),K.select("#cursor").style("fill-opacity",0).style("stroke",null),console.log("Switched to center mode (manual)")):"btn-erase"==e.id?(u="erase",e.classList.add("btn-active"),K.select("#cursor").style("fill",null).style("fill-opacity",0).style("stroke","red").style("stroke-width",.5),console.log("Switched to erase mode")):"btn-draw-auxline"==e.id?(u="auxline",e.classList.add("btn-active"),K.select("#cursor").style("fill","magenta").style("fill-opacity",1).style("stroke",null),console.log("Switched to auxline mode")):"btn-draw-auxcurve"==e.id?(u="auxcurve",e.classList.add("btn-active"),K.select("#cursor").style("fill","magenta").style("fill-opacity",1).style("stroke",null),console.log("Switched to auxcurve mode")):"btn-get-intersects"==e.id?(u=null,K.select("#cursor").style("fill-opacity",0).style("stroke",null),nt(h),W(),dt(),console.log("Computed new corners as intersections of auxiliary lines.")):"btn-mark-module-partially-visible"==e.id&&(u="mark_module_partially_visible",e.classList.add("btn-active"),K.select("#cursor").style("fill-opacity",0).style("stroke",null))},X.addEventListener("click",Z,!1),K.on("click",(function(){if("corner"==u)G.push({x:f,y:d,id:x()}),console.log("Placed a new corner marker at (",f,",",d,")"),W(),dt();else if("center"==u)if(G.length<4)alert("Before you can create a grid cell you need to place at least four corner markers first.");else{for(var t=[],e=0;e<j.length;e++)t.push(j[e].corner);t=tt(t);var n=et(t);F.push({corners:t,center:n,id:x(),truncated:!1}),console.log("Placed a new grid cell at (",n.x,",",n.y,")"),W(),dt()}else"auxline"==u?(b.push({x:f,y:d}),2==b.length&&(v.push({x1:b[0].x,y1:b[0].y,x2:b[1].x,y2:b[1].y,id:x()}),console.log("Placed auxiliary line from (",b[0].x,",",b[0].y,") to (",b[1].x,",",b[1].y,")"),b=[],W(),dt())):"auxcurve"==u&&(E.push([f,d]),3==E.length&&(g.push({points:E,id:x()}),E=[],console.log("Placed auxiliary curve"),W(),dt()))})),tt=function(t){var e=t.sort((function(t,e){return t.x>e.x?1:-1})),n=e.slice(0,2),r=e.slice(2,4),o=n.sort((function(t,e){return t.y>e.y?1:-1})),a=o[0],i=o[1],c=r.sort((function(t,e){return t.y>e.y?1:-1}));return[c[0],a,i,c[1]]},et=function(t){for(var e={x:0,y:0},n=0;n<t.length;n++)e.x+=t[n].x,e.y+=t[n].y;return e.x/=t.length,e.y/=t.length,e},ut=function(t){"erase"==u&&(this.classList.contains("corner_marker")?function(t){d3.select(t).on("mousedown.drag",null);for(var e=d3.select(t).attr("id"),n=G.length-1;n>=0;n--)if(G[n].id==e){for(var r=h.length-1;r>=0;r--)h[r].x==G[n].x&&h[r].y==G[n].y&&h.splice(r,1);console.log("Deleting corner "+e),G.splice(n,1)}var o=[];for(n=0;n<F.length;n++)for(r=0;r<F[n].corners.length;r++)F[n].corners[r].id==e&&o.push(n);for(n=o.length-1;n>=0;n--)console.log("Deleting grid cell "+F[n].id+"(it contained deleted point "+e+")"),F.splice(o[n],1)}(this):this.classList.contains("auxline-erase")?function(t){for(var e=d3.select(t.parentNode).attr("id"),n=v.length-1;n>=0;n--)v[n].id==e&&(console.log("Deleting auxline "+e),v.splice(n,1))}(this):this.classList.contains("auxcurve-erase")&&function(t){for(var e=d3.select(t.parentNode).attr("id"),n=g.length-1;n>=0;n--)g[n].id==e&&(console.log("Deleting auxcurve "+e),g.splice(n,1))}(this),W(),dt())},ft=function(t){if("mark_module_partially_visible"==u){N=t.id;for(var e=0;e<F.length;e++)if(F[e].id==N){var n=F[e].truncated;F[e].truncated=!n}W(),dt(),q()}},dt=function(){var t=K.select("#g_auxobjects").selectAll(".auxline").data(v,(function(t){return t.id})),e=t.enter().append("g").attr("id",(function(t){return t.id}));e.append("line").attr("class","auxobj auxline auxline-erase").attr("x1",(function(t){return t.x1})).attr("y1",(function(t){return t.y1})).attr("x2",(function(t){return t.x2})).attr("y2",(function(t){return t.y2})).style("stroke","magenta").style("stroke-opacity",.5).style("stroke-width",1).on("mousedown",ut),e.append("circle").attr("class","auxline-startpoint auxline-erase").attr("cx",(function(t){return t.x1})).attr("cy",(function(t){return t.y1})).style("r",1.5).style("fill","magenta").on("mousedown",ut).call(d3.drag().on("drag",ct)),e.append("circle").attr("class","auxline-endpoint auxline-erase").attr("cx",(function(t){return t.x2})).attr("cy",(function(t){return t.y2})).style("r",1.5).style("fill","magenta").on("mousedown",ut).call(d3.drag().on("drag",ct)),e.merge(t),t.exit().each((function(){d3.select(this.parentNode).remove()}));var n=K.select("#g_auxobjects").selectAll(".auxcurve").data(g,(function(t){return t.id})),r=n.enter().append("g").attr("id",(function(t){return t.id}));r.append("path").attr("class","auxobj auxcurve auxcurve-erase").attr("d",(function(t){return lt(t.points)})).style("stroke","magenta").style("fill","none").style("stroke-width",1).style("stroke-opacity",.5).on("mousedown",ut),r.append("circle").attr("class","auxcurve-startpoint auxcurve-erase").attr("cx",(function(t){return t.points[0][0]})).attr("cy",(function(t){return t.points[0][1]})).style("r",1.5).style("fill","magenta").on("mousedown",ut).call(d3.drag().on("drag",st)),r.append("circle").attr("class","auxcurve-middlepoint auxcurve-erase").attr("cx",(function(t){return t.points[1][0]})).attr("cy",(function(t){return t.points[1][1]})).style("r",1.5).style("fill","magenta").on("mousedown",ut).call(d3.drag().on("drag",st)),r.append("circle").attr("class","auxcurve-endpoint auxcurve-erase").attr("cx",(function(t){return t.points[2][0]})).attr("cy",(function(t){return t.points[2][1]})).style("r",1.5).style("fill","magenta").on("mousedown",ut).call(d3.drag().on("drag",st)),r.merge(n),n.exit().each((function(){d3.select(this.parentNode).remove()})),K.select("#g_corners").selectAll(".corner_marker").data(G).join("circle").attr("class","corner_marker").attr("id",(function(t){return t.id})).attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",2).attr("fill","magenta").on("mousedown.1",ut).on("mousedown.2",rt).call(d3.drag().on("start",ot).on("drag",it).on("end",at)),K.select("#g_pv_modules").selectAll(".pv_module").data(F).join("polygon").attr("class","pv_module").attr("id",(function(t){return t.id})).attr("points",(function(t){return t.corners.map((function(t){return[t.x,t.y].join(",")})).join(" ")})).style("fill",(function(t){return t.truncated?"yellow":"lawngreen"})).style("fill-opacity",.5).style("stroke",(function(t){return t.truncated?"yellow":"lawngreen"})).style("stroke-width",.5).on("mousedown",ut).on("click",ft),K.select("#g_pv_modules").selectAll(".pv_module_center").data(F).join("circle").attr("class","pv_module_center").attr("cx",(function(t){return t.center.x})).attr("cy",(function(t){return t.center.y})).attr("r",2).attr("fill","black")};case 59:case"end":return t.stop()}}),t)}))),N.apply(this,arguments)}!function(t){g.apply(this,arguments)}((function(){!function(t){N.apply(this,arguments)}(project_id)}))})();